#Generated by chatGPT
import paho.mqtt.client as mqtt

# MQTT broker information
broker = '127.0.0.1'  # Use your broker address
port = 1883
subscribe_topic = 'cabot/output/targetmotorposition'
publish_topic_base = 'cabot/targetpos/targetmotorposition'

# Define the callback for when a message is received
def on_message(client, userdata, msg):
    message = msg.payload.decode()
    print(f"Received message: {message}")

    # Split the message into 8 variables (assuming comma-separated values)
    variables = message.split(',')
    if len(variables) != 3:
        print("Error: Expected 8 variables in the message")
        return

    # Publish each variable to a separate topic
    for i, var in enumerate(variables):
        topic = f"{publish_topic_base}{i+1}"
        client.publish(topic, var)
        print(f"Published {var} to {topic}")


# Set up the MQTT client
client = mqtt.Client()

# Attach the message callback
client.on_message = on_message

# Connect to the broker
client.connect(broker, port, 60)

# Subscribe to the topic
client.subscribe(subscribe_topic)

# Start the loop to process received messages
client.loop_start()

try:
    # Keep the script running
    while True:
        pass
except KeyboardInterrupt:
    print("Exiting...")

# Stop the loop and disconnect
client.loop_stop()
client.disconnect()
